<!DOCTYPE html>

<html>

<head>

  <title>Redirecting...</title>

  <meta charset="UTF-8">

  <script>

    // CONFIGURE THESE VALUES

    const SHEET_ID = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRZTeEUipQh45VOJO17G9JhRBktmaiBQnfvom2RFqTK_taf4AnY1pbbYFhsOoVZr1_LD48wlNVNMWu/pubhtml";

    const SHEET_TAB = "Sheet1";



    function getParam(name) {

      const url = new URL(window.location.href);

      return url.searchParams.get(name);

    }



    async function redirectToResult() {

      const subID = getParam('submission_id');

      if (!subID) {

        document.body.innerHTML = "<h3>Missing submission ID in URL.</h3>";

        return;

      }



      const endpoint = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_TAB}`;

      try {

        const res = await fetch(endpoint);

        const text = await res.text();

        const json = JSON.parse(text.substr(47).slice(0, -2)); // Remove Google Sheets wrapper



        const headers = json.table.cols.map(col => col.label);

        const rows = json.table.rows.map(row =>

          row.c.reduce((acc, val, idx) => {

            acc[headers[idx]] = val ? val.v : "";

            return acc;

          }, {})

        );



        const match = rows.find(row => row.submission_id === subID);

        if (match && match.eligibility_url) {

          window.location.href = match.eligibility_url;

        } else {

          document.body.innerHTML = `<h3>No match found for submission ID: ${subID}</h3>`;

        }



      } catch (err) {

        console.error(err);

        document.body.innerHTML = `<h3>Error fetching redirect data.</h3>`;

      }

    }



    document.addEventListener("DOMContentLoaded", redirectToResult);

  </script>

</head>

<body>

  <h3>Checking eligibilityâ€¦</h3>

</body>

</html>