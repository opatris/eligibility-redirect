<!DOCTYPE html>
<html>
<head>
<title>Redirecting...</title>
<meta charset="UTF-8">
<script>
const SHEET_ID = "1FbTafveUOpNkExfkMYkqKNYw0j2IW3aeVcIWY6-sHeU";
const SHEET_TAB = "redirects";

function getParam(name) {
const url = new URL(window.location.href);
return url.searchParams.get(name);
}

async function redirectToResult() {
const subID = getParam('submission_id');
if (!subID) {
document.body.innerHTML = "<h3>Missing submission ID in URL.</h3>";
return;
}

const endpoint = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_TAB}`;
try {
const res = await fetch(endpoint);
const text = await res.text();
const json = JSON.parse(text.substring(47).slice(0, -2)); // strip Google Sheets wrapper

const rows = json.table.rows
.map(row => row.c.map(cell => (cell ? cell.v : ""))) // extract raw values
.filter(row => row.length > 1 && row[0] !== "submission_id"); // skip header

const match = rows.find(row => row[0] === subID);

if (match && match[1]) {
window.location.href = match[1]; // redirect to eligibility_url
} else {
document.body.innerHTML = `<h3>Please refresh page. Currently searching for submission ID: ${subID}</h3>`;
}

} catch (err) {
console.error(err);
document.body.innerHTML = `<h3>Error fetching redirect data.</h3>`;
}
}

document.addEventListener("DOMContentLoaded", redirectToResult);
</script>
</head>
<body>
<h3>Checking eligibilityâ€¦</h3>
</body>
</html>

